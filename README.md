# 12条点検 Web アプリ

このアプリケーションは、点検データの入力・保存・閲覧を行うシステムです。デジタルカメラで撮影した写真の写真番号を手動で入力することで、写真情報と劣化状況を記録します。

## 必要要件

- Python 3.8以上
- pip（Pythonパッケージマネージャー）

## インストール方法

1. リポジトリをクローンまたはダウンロードします。

2. 必要なパッケージをインストールします：
```bash
pip install -r requirements.txt
```

## 使用方法

1. アプリケーションを起動します：
```bash
streamlit run app.py
```

2. Webブラウザが自動的に開き、アプリケーションにアクセスできます。

## 機能

### 点検入力タブ
- 基本情報（点検日、点検者名、現場ID、備考）の入力
- 劣化内容（場所、劣化名、写真番号）の入力
- データの保存

### データ閲覧タブ
- 保存済みデータの表示
- データの検索・フィルタリング
- CSVファイルのダウンロード

## データ保存

- 点検データは `data/inspection_data.csv` に保存されます
- エンコーディングは utf-8-sig（Excel貼り付け対応）
- 予測変換用のマスターデータは `data/master_data.csv` で管理されます

---

# 12条点検 Web アプリ 仕様書（デジカメ撮影）

## 1. 概要
本アプリは、点検データの入力・保存・閲覧を行うシステムです。  
点検現場では、デジタルカメラで撮影した写真の「写真番号」を手動で入力することで、写真情報と劣化状況を記録します。  
シンプルな入力フォームで運用することを目的とします。

## 2. システム構成
- **フロントエンド:**  
  - Streamlit を用いたシンプルなWeb UI
- **バックエンド:**  
  - Python（pandas、os、json、datetime 等のライブラリを利用）
- **データ保存:**  
  - 点検データはCSVファイル形式（Excel貼り付け対応：utf-8-sig エンコーディング）で管理

## 3. ユーザーインターフェース
### 3.1 ページ設定
- ページタイトル：「12条点検 Web アプリ」
- レイアウト：幅広レイアウト（wide）
- サイドバー：初期状態で展開

### 3.2 タブ構成
- **点検入力タブ：**  
  点検情報および各種劣化項目の入力画面
- **データ閲覧タブ：**  
  保存済み点検データの表示・検索およびCSVダウンロード画面

## 4. 入力機能（点検入力タブ）
### 4.1 基本情報セクション
- **点検日：** 日付入力コンポーネント
- **点検者名：** テキスト入力コンポーネント
- **現場ID：** テキストまたは選択式入力コンポーネント
- **備考：** 任意入力（テキストエリア等）

### 4.2 劣化内容セクション
- **劣化番号：**  
  各劣化項目に対して自動採番し、一意の番号を発行。画面上に表示し、各劣化項目の識別に利用する。
- **場所：**  
  テキスト入力コンポーネント  
  ※ 予測変換機能を利用し、入力開始時に候補を自動提示（下記「予測変換機能」参照）。
- **劣化名：**  
  テキスト入力コンポーネント  
  ※ 同様に予測変換機能により候補を提示し、効率的な入力を支援。
- **写真番号：**  
  デジタルカメラで撮影した写真に付与された番号を、ユーザーが手動で入力する欄。  
  入力された写真番号は、劣化データと連動して保存される。

### 4.3 予測変換機能
- **目的：**  
  入力作業の効率化と誤入力の低減を図るため、場所および劣化名の入力欄に予測変換機能を実装する。
- **動作：**  
  ユーザーが入力を開始し、最初の1文字を入力すると、あらかじめ定義された変換リスト（例：CSVファイルで管理）から、該当する候補が自動的に表示される。  
  ユーザーは候補を選択するか、そのまま自由に入力を続けることが可能。
  
### 4.4 保存処理
- **データ集計：**  
  保存対象は以下の項目を含む。
  - 【基本情報】：点検日、点検者名、現場ID、備考
  - 【各劣化項目】：劣化番号、場所、劣化名、写真番号
- **保存方法：**  
  - ユーザーが「保存」ボタンをクリックすると、現在の入力内容がCSVファイル（例：`data/inspection_data.csv`）に保存される。
  - 保存先ディレクトリが存在しない場合は自動生成される。
  - 既存データは上書きまたは追記方式で更新可能。  
  - エンコーディングは utf-8-sig（Excel貼り付け対応）。

## 5. データ閲覧機能
### 5.1 保存済みデータの表示
- 保存されたCSVファイルから点検データを読み込み、テーブル形式で表示する。
- ファイルが存在しない場合、適切な情報メッセージを表示する。

### 5.2 検索・フィルタリング機能
- 点検日、現場ID、劣化番号、写真番号などをキーとして、部分一致検索を実施する。

### 5.3 CSVダウンロード機能
- 保存済み点検データを、Excel貼り付け対応のCSV形式（utf-8-sig エンコーディング）でダウンロード可能とする。

## 6. セッション管理
- ユーザーが入力中の各劣化項目およびその他の入力値は、セッション状態（st.session_state など）で一時的に保持する。

## 7. エラーハンドリング
- **マスターデータの読み込み：**  
  マスターデータファイルが存在しない、エンコーディングエラー、または必要な列が欠如している場合、エラーメッセージを表示し、処理を中断または代替処理を行う。
- **保存処理：**  
  入力されたデータは必須チェックを行わずそのまま保存する。

## 8. 技術的詳細
- **使用ライブラリ：**  
  Streamlit, pandas, os, json, datetime
- **ファイルエンコーディング：**  
  - マスターデータ CSV：shift_jis  
  - 保存データ CSV：utf-8-sig（Excel貼り付け対応）
- **データ保存：**  
  劣化データは必要に応じてJSON形式（ensure_ascii=False）にシリアライズし、CSVの「劣化データ」フィールドにまとめるか、個別項目として出力する。 